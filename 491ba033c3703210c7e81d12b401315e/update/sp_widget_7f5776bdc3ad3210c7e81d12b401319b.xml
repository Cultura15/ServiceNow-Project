<?xml version="1.0" encoding="UTF-8"?><record_update table="sp_widget">
    <sp_widget action="INSERT_OR_UPDATE">
        <category>custom</category>
        <client_script><![CDATA[api.controller = function($scope, $window) {
  var c = this;

  // View detailed order info
  c.viewOrder = function(sys_id) {
    $window.location.href = '/psmp?id=psmp_order&order_sys_id=' + sys_id;
  };

  // Back button behavior
  c.goBack = function() {
    $window.location.href = '/psmp?id=psmp_shop'; // Adjust this to your shop page ID
  };
};
api.controller.$inject = ['$scope', '$window'];
]]></client_script>
        <controller_as>c</controller_as>
        <css>/* CONTAINER */&#13;
.order-history-container {&#13;
  max-width: 900px;&#13;
  margin: 0 auto;&#13;
  padding: 20px;&#13;
  font-family: "Segoe UI", Roboto, sans-serif;&#13;
}&#13;
&#13;
/* TITLE */&#13;
.history-title {&#13;
  font-size: 1.8em;&#13;
  margin-bottom: 25px;&#13;
  color: #2c3e50;&#13;
}&#13;
&#13;
/* ORDER CARD */&#13;
.order-card {&#13;
  background: #fff;&#13;
  border-radius: 16px;&#13;
  padding: 20px;&#13;
  margin-bottom: 16px;&#13;
  box-shadow: 0 4px 15px rgba(0,0,0,0.08);&#13;
  transition: transform 0.3s, box-shadow 0.3s;&#13;
  cursor: pointer;&#13;
  display: flex;&#13;
  flex-direction: column;&#13;
  gap: 12px;&#13;
}&#13;
&#13;
.order-card:hover {&#13;
  transform: translateY(-3px);&#13;
  box-shadow: 0 8px 25px rgba(0,0,0,0.12);&#13;
}&#13;
&#13;
/* HEADER */&#13;
.order-header {&#13;
  display: flex;&#13;
  justify-content: space-between;&#13;
  align-items: center;&#13;
  font-weight: 600;&#13;
  color: #34495e;&#13;
}&#13;
&#13;
.order-number {&#13;
  font-size: 16px;&#13;
}&#13;
&#13;
.order-date {&#13;
  font-size: 14px;&#13;
  color: #7f8c8d;&#13;
}&#13;
&#13;
/* DESCRIPTION */&#13;
.order-desc {&#13;
  font-size: 14px;&#13;
  color: #555;&#13;
  margin: 0;&#13;
  line-height: 1.5;&#13;
}&#13;
&#13;
/* FOOTER */&#13;
.order-footer {&#13;
  display: flex;&#13;
  justify-content: space-between;&#13;
  align-items: center;&#13;
  margin-top: 10px;&#13;
}&#13;
&#13;
/* TOTAL AMOUNT */&#13;
.order-total {&#13;
  font-weight: 700;&#13;
  font-size: 15px;&#13;
  color: #27ae60;&#13;
}&#13;
&#13;
/* ORDER STATE BADGE */&#13;
.order-state {&#13;
  padding: 6px 14px;&#13;
  border-radius: 20px;&#13;
  font-weight: bold;&#13;
  color: #fff;&#13;
  text-transform: capitalize;&#13;
  font-size: 13px;&#13;
  white-space: nowrap;&#13;
}&#13;
&#13;
/* Closed Complete State */&#13;
.state-closed-complete {&#13;
  background: linear-gradient(135deg, #27ae60, #2ecc71);&#13;
}&#13;
&#13;
/* EMPTY HISTORY */&#13;
.empty-history {&#13;
  text-align: center;&#13;
  padding: 60px 20px;&#13;
  background: #fff;&#13;
  border-radius: 16px;&#13;
  box-shadow: 0 4px 15px rgba(0,0,0,0.08);&#13;
}&#13;
&#13;
.empty-history .empty-icon {&#13;
  font-size: 80px;&#13;
  opacity: 0.3;&#13;
  margin-bottom: 20px;&#13;
  animation: float 3s ease-in-out infinite;&#13;
}&#13;
&#13;
@keyframes float {&#13;
  0%, 100% { transform: translateY(0); }&#13;
  50% { transform: translateY(-15px); }&#13;
}&#13;
&#13;
/* BACK BUTTON */&#13;
.back-btn {&#13;
  margin-top: 20px;&#13;
  background: #27ae60;&#13;
  color: white;&#13;
  border: none;&#13;
  border-radius: 12px;&#13;
  padding: 12px 28px;&#13;
  font-weight: bold;&#13;
  font-size: 14px;&#13;
  cursor: pointer;&#13;
  transition: all 0.3s ease;&#13;
}&#13;
&#13;
.back-btn:hover {&#13;
  background: #2ecc71;&#13;
  transform: translateY(-2px);&#13;
}&#13;
&#13;
/* RESPONSIVE */&#13;
@media(max-width: 640px) {&#13;
  .order-card {&#13;
    padding: 16px;&#13;
  }&#13;
  &#13;
  .order-header {&#13;
    flex-direction: column;&#13;
    align-items: flex-start;&#13;
    gap: 6px;&#13;
  }&#13;
&#13;
  .order-footer {&#13;
    flex-direction: column;&#13;
    align-items: flex-start;&#13;
    gap: 6px;&#13;
  }&#13;
}&#13;
</css>
        <data_table>sp_instance</data_table>
        <demo_data/>
        <description/>
        <docs/>
        <field_list/>
        <has_preview>false</has_preview>
        <id/>
        <internal>false</internal>
        <link><![CDATA[function link(scope, element, attrs, controller) {  }]]></link>
        <name>Pet Shop User History</name>
        <option_schema/>
        <public>false</public>
        <roles/>
        <script><![CDATA[(function() {
  data.orders = [];

  var userID = gs.getUserID();

  var gr = new GlideRecord("x_1607167_pet_shop_pet_shop_order");
  gr.addQuery("order_for", userID);
  gr.addQuery("state", 3); // ‚úÖ 3 = Closed Complete
  gr.orderByDesc("sys_created_on");
  gr.query();

  while (gr.next()) {
    data.orders.push({
      sys_id: gr.getUniqueValue(),
      number: gr.getDisplayValue("number"),
      short_description: gr.getValue("short_description"),
      total_amount: parseFloat(gr.getValue("total_amount") || 0),
      state: gr.getDisplayValue("state"),
      state_value: gr.getValue("state"),
      created_on: gr.getDisplayValue("sys_created_on")
    });
  }

  data.hasOrders = data.orders.length > 0;
})();
]]></script>
        <servicenow>false</servicenow>
        <sys_class_name>sp_widget</sys_class_name>
        <sys_created_by>admin</sys_created_by>
        <sys_created_on>2025-12-02 06:27:35</sys_created_on>
        <sys_id>7f5776bdc3ad3210c7e81d12b401319b</sys_id>
        <sys_mod_count>2</sys_mod_count>
        <sys_name>Pet Shop User History</sys_name>
        <sys_package display_value="Pet Shop Needs Management" source="x_1607167_pet_shop">491ba033c3703210c7e81d12b401315e</sys_package>
        <sys_policy/>
        <sys_scope display_value="Pet Shop Needs Management">491ba033c3703210c7e81d12b401315e</sys_scope>
        <sys_update_name>sp_widget_7f5776bdc3ad3210c7e81d12b401319b</sys_update_name>
        <sys_updated_by>admin</sys_updated_by>
        <sys_updated_on>2025-12-02 17:05:57</sys_updated_on>
        <template><![CDATA[<div class="order-history-container" ng-if="c.data.hasOrders">
  <h2 class="history-title">]]>üìú<![CDATA[ My Pet Order History</h2>

  <div class="order-card" 
       ng-repeat="order in c.data.orders track by order.sys_id" 
       ng-click="c.viewOrder(order.sys_id)">

    <div class="order-header">
      <div class="order-number">Order #{{order.number}}</div>
      <div class="order-date">{{order.created_on}}</div>
    </div>

    <p class="order-desc">{{order.short_description || 'No description provided'}}</p>

    <div class="order-footer">
      <span class="order-total">]]>üí∞<![CDATA[ ‚Ç±{{order.total_amount | number:2}}</span>
      <span class="order-state state-closed-complete">‚úÖ {{order.state}}</span>
    </div>
  </div>
</div>

<div class="empty-history" ng-if="!c.data.hasOrders">
  <div class="empty-icon">]]>üì¶<![CDATA[</div>
  <p>You don‚Äôt have any completed orders yet ]]>üêæ<![CDATA[</p>
  <button class="back-btn" ng-click="c.goBack()">‚¨Ö Back to Shop</button>
</div>
]]></template>
    </sp_widget>
    <sys_es_latest_script action="INSERT_OR_UPDATE">
        <id>7f5776bdc3ad3210c7e81d12b401319b</id>
        <sys_created_by>admin</sys_created_by>
        <sys_created_on>2025-12-02 06:27:34</sys_created_on>
        <sys_id>78c776fdc3ad3210c7e81d12b4013100</sys_id>
        <sys_mod_count>0</sys_mod_count>
        <sys_updated_by>admin</sys_updated_by>
        <sys_updated_on>2025-12-02 06:27:34</sys_updated_on>
        <table>sp_widget</table>
        <use_es_latest>true</use_es_latest>
    </sys_es_latest_script>
</record_update>
